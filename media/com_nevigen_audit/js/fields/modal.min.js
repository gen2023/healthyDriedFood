(()=>{"use strict";window.NevigenAuditFieldModal={initialization(e){let t=e.getAttribute("data-selector"),l=e.getAttribute("data-selector");"false"!==e.getAttribute("data-dynamic")&&(l=this.generateSelector()),e.setAttribute("data-selector",l),e.hasAttribute("data-get")&&e.setAttribute("data-get",e.getAttribute("data-get").replaceAll(t,l)),e.innerHTML=e.innerHTML.replaceAll(t,l),e.querySelectorAll('[id*="_modal_"]').forEach(e=>{window.NevigenAuditFieldModal.setModalsUrlParam(e,"selector",l)}),window.NevigenAuditFieldModal.setValue(l,e.querySelector('input[nevigen-audit-field-modal="id"]').value,!1)},selectItem(e){if(e){let t=e.getAttribute("data-id"),l=e.getAttribute("data-selector");null!==t&&null!==l&&window.NevigenAuditFieldModal.setValue(l,t)}Joomla.Modal.getCurrent()&&Joomla.Modal.getCurrent().close()},processItem(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t&&(t=e.getAttribute("data-task"));let l=e.getAttribute("data-task_prefix"),i=e.getAttribute("data-modal_id"),d=e.getAttribute("data-form_id"),a=e.getAttribute("data-field_id"),n=e.getAttribute("data-selector");if(document.querySelector('[nevigen-audit-field-modal="container"][data-selector="'+n+'"]')&&i){let o=document.getElementById(i),r=o.querySelector("iframe");if(r){let i=o.getAttribute("id").replace("modal","iframe");r.setAttribute("id",i);let u=r.contentDocument,s=l?l+"."+t:t;if("cancel"===t){r.contentWindow.Joomla.submitbutton(s),Joomla.Modal.getCurrent().close();let e=document.querySelector(".modal-backdrop.fade.show");e&&(o.style.display="",o.classList.remove("show"),e.remove(),Joomla.Modal.setCurrent(null))}else r.addEventListener("load",l=>{u=l.target.contentDocument;let i=!!u&&u.getElementById(a);if(i){let l=parseInt(i.value);l&&0!==l&&window.NevigenAuditFieldModal.setValue(n,l),"save"===t&&window.NevigenAuditFieldModal.processItem(e,"cancel")}}),u.formvalidator.isValid(u.getElementById(d))&&("save"===t&&(s=l?l+".apply":"apply"),r.contentWindow.Joomla.submitbutton(s))}}},setValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=2>=arguments.length||void 0===arguments[2]||arguments[2],i=document.querySelector('[nevigen-audit-field-modal="container"][data-selector="'+e+'"]');if(i){let e=i.querySelector('input[nevigen-audit-field-modal="id"]'),d=i.querySelector('input[nevigen-audit-field-modal="title"]');if(e&&d){t=parseInt(t);let e={id:t,title:""};if(t&&0!==t){let d=i.getAttribute("data-get");null!==d?(e.title=Joomla.Text._("COM_NEVIGEN_AUDIT_AJAX_LOADING"),window.NevigenAuditFieldModal.setFieldValue(i,e,!1,!1),Joomla.request({url:d,method:"POST",data:JSON.stringify(e),headers:{"Content-Type":"application/json"},onSuccess:t=>{try{if(!(t=JSON.parse(t)).success)throw Error(t.message);window.NevigenAuditFieldModal.setFieldValue(i,t.data,l)}catch(t){e.id="",e.title="",window.NevigenAuditFieldModal.setFieldValue(i,e,!1),Joomla.renderMessages({error:[t.message]})}},onError:t=>{e.id="",e.title="",window.NevigenAuditFieldModal.setFieldValue(i,e,!1),Joomla.renderMessages({error:[t.message]})}})):(e.title=t,window.NevigenAuditFieldModal.setFieldValue(i,e,l))}else window.NevigenAuditFieldModal.setFieldValue(i,e,l)}}},setFieldValue(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=2>=arguments.length||void 0===arguments[2]||arguments[2],i=3>=arguments.length||void 0===arguments[3]||arguments[3];if(e){let d=e.querySelector('input[nevigen-audit-field-modal="id"]'),a=e.querySelector('input[nevigen-audit-field-modal="title"]');if(d&&a){d.value=t.id?t.id:"",a.value=t.title?t.title:t.id?t.id:"",d.setAttribute("data-item",JSON.stringify(t));let n=parseInt(t.id);n||(n=0);let o=e.querySelector('[id*="_modal_edit"]');o&&window.NevigenAuditFieldModal.setModalsUrlParam(o,"id",n),l&&d.dispatchEvent(new Event("change"));let r=e.querySelector('[nevigen-audit-field-modal="button_select"]'),u=e.querySelector('[nevigen-audit-field-modal="button_create"]'),s=e.querySelector('[nevigen-audit-field-modal="button_edit"]'),c=e.querySelector('[nevigen-audit-field-modal="button_clear"]');r&&(r.style.display="none"),u&&(u.style.display="none"),s&&(s.style.display="none"),c&&(c.style.display="none"),i&&(t.id?(s&&(s.style.display=""),c&&(c.style.display="")):(r&&(r.style.display=""),u&&(u.style.display="")));let g=e.querySelector('[nevigen-audit-field-modal="image"]');g&&(g.src=t.image?t.image:g.getAttribute("data-noimage")),d.dispatchEvent(new Event("load"))}}},setModalsUrlParam(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e&&t){let i=window.NevigenAuditFieldModal.replaceUrlParam(e.getAttribute("data-url"),t,l);e.setAttribute("data-url",i);let d=document.createElement("div");d.innerHTML=e.getAttribute("data-iframe");let a=d.querySelector("iframe"),n=window.NevigenAuditFieldModal.replaceUrlParam(a.getAttribute("src"),t,l);a.setAttribute("src",n),e.setAttribute("data-iframe",d.innerHTML);let o=document.getElementById(e.getAttribute("id"));Joomla.initialiseModal(o)}},replaceUrlParam(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e)return"";let i=new URLSearchParams(e);return l?i.set(t,""+l):i.delete(t),(""+i).replaceAll("%2F","/").replaceAll("%3F","?")},generateSelector(){let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890".split(""),t=[];for(let l=0;32>l;l++){let i=(Math.random()*(e.length-1)).toFixed(0);t[l]=e[i]}let l=t.join("");return document.querySelector('[nevigen-audit-field-modal="container"][data-selector="'+l+'"]')?this.generateSelector():l}},document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll('[nevigen-audit-field-modal="container"]').forEach(e=>{NevigenAuditFieldModal.initialization(e)})}),document.addEventListener("subform-row-add",e=>{e.target.querySelectorAll('[nevigen-audit-field-modal="container"]').forEach(e=>{NevigenAuditFieldModal.initialization(e)})})})();