/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/*!************************************************!*\
  !*** ./com_nevigen_audit/es6/fields/modal.es6 ***!
  \************************************************/
/*
 * @package    Nevigen Audit Package
 * @version    1.2.0
 * @author     Nevigen.com - https://nevigen.com
 * @copyright  Copyright Â© Nevigen.com. All rights reserved.
 * @license    Proprietary. Copyrighted Commercial Software
 * @link       https://nevigen.com
 */



window.NevigenAuditFieldModal = {
  initialization(container) {
    let oldSelector = container.getAttribute('data-selector'),
      newSelector = container.getAttribute('data-selector');
    if (container.getAttribute('data-dynamic') !== 'false') {
      newSelector = this.generateSelector();
    }
    container.setAttribute('data-selector', newSelector);
    if (container.hasAttribute('data-get')) {
      container.setAttribute('data-get', container.getAttribute('data-get').replaceAll(oldSelector, newSelector));
    }
    container.innerHTML = container.innerHTML.replaceAll(oldSelector, newSelector);
    container.querySelectorAll('[id*="_modal_"]').forEach(modal => {
      window.NevigenAuditFieldModal.setModalsUrlParam(modal, 'selector', newSelector);
    });
    window.NevigenAuditFieldModal.setValue(newSelector, container.querySelector('input[nevigen-audit-field-modal="id"]').value, false);
  },
  selectItem(element) {
    if (element) {
      let id = element.getAttribute('data-id'),
        selector = element.getAttribute('data-selector');
      if (id !== null && selector !== null) {
        window.NevigenAuditFieldModal.setValue(selector, id);
      }
    }
    if (Joomla.Modal.getCurrent()) {
      Joomla.Modal.getCurrent().close();
    }
  },
  processItem(button) {
    let task = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
    if (task === null) {
      task = button.getAttribute('data-task');
    }
    let task_prefix = button.getAttribute('data-task_prefix'),
      modal_id = button.getAttribute('data-modal_id'),
      form_id = button.getAttribute('data-form_id'),
      field_id = button.getAttribute('data-field_id'),
      selector = button.getAttribute('data-selector');
    let container = document.querySelector('[nevigen-audit-field-modal="container"][data-selector="' + selector + '"]');
    if (container && modal_id) {
      let modal = document.getElementById(modal_id),
        iframe = modal.querySelector('iframe');
      if (iframe) {
        let iframe_id = modal.getAttribute('id').replace('modal', 'iframe');
        iframe.setAttribute('id', iframe_id);
        let iframeDocument = iframe.contentDocument;
        let submittedTask = task_prefix ? task_prefix + '.' + task : task;
        if (task === 'cancel') {
          iframe.contentWindow.Joomla.submitbutton(submittedTask);
          Joomla.Modal.getCurrent().close();
          let modalOverlay = document.querySelector('.modal-backdrop.fade.show');
          if (modalOverlay) {
            modal.style.display = '';
            modal.classList.remove('show');
            modalOverlay.remove();
            Joomla.Modal.setCurrent(null);
          }
        } else {
          iframe.addEventListener('load', event => {
            iframeDocument = event.target.contentDocument;
            let field = iframeDocument ? iframeDocument.getElementById(field_id) : false;
            if (field) {
              let value = parseInt(field.value),
                hasValue = value && value !== 0;
              if (hasValue) {
                window.NevigenAuditFieldModal.setValue(selector, value);
              }
              if (task === 'save') {
                window.NevigenAuditFieldModal.processItem(button, 'cancel');
              }
            }
          });
          if (iframeDocument.formvalidator.isValid(iframeDocument.getElementById(form_id))) {
            if (task === 'save') {
              submittedTask = task_prefix ? task_prefix + '.apply' : 'apply';
            }
            iframe.contentWindow.Joomla.submitbutton(submittedTask);
          }
        }
      }
    }
  },
  setValue(selector) {
    let value = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';
    let changeEvent = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
    let container = document.querySelector('[nevigen-audit-field-modal="container"][data-selector="' + selector + '"]');
    if (container) {
      let field_id = container.querySelector('input[nevigen-audit-field-modal="id"]'),
        field_title = container.querySelector('input[nevigen-audit-field-modal="title"]');
      if (field_id && field_title) {
        value = parseInt(value);
        let hasValue = value && value !== 0;
        let data = {
          'id': value,
          'title': ''
        };
        if (hasValue) {
          let url = container.getAttribute('data-get');
          if (url !== null) {
            data.title = Joomla.Text._('COM_NEVIGEN_AUDIT_AJAX_LOADING');
            window.NevigenAuditFieldModal.setFieldValue(container, data, false, false);
            Joomla.request({
              url,
              method: 'POST',
              data: JSON.stringify(data),
              headers: {
                'Content-Type': 'application/json'
              },
              onSuccess: response => {
                try {
                  response = JSON.parse(response);
                  if (!response.success) {
                    throw new Error(response.message);
                  }
                  window.NevigenAuditFieldModal.setFieldValue(container, response.data, changeEvent);
                } catch (error) {
                  data.id = '';
                  data.title = '';
                  window.NevigenAuditFieldModal.setFieldValue(container, data, false);
                  Joomla.renderMessages({
                    error: [error.message]
                  });
                }
              },
              onError: error => {
                data.id = '';
                data.title = '';
                window.NevigenAuditFieldModal.setFieldValue(container, data, false);
                Joomla.renderMessages({
                  error: [error.message]
                });
              }
            });
          } else {
            data.title = value;
            window.NevigenAuditFieldModal.setFieldValue(container, data, changeEvent);
          }
        } else {
          window.NevigenAuditFieldModal.setFieldValue(container, data, changeEvent);
        }
      }
    }
  },
  setFieldValue() {
    let container = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
    let data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    let changeEvent = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
    let displayButtons = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;
    if (container) {
      let field_id = container.querySelector('input[nevigen-audit-field-modal="id"]'),
        field_title = container.querySelector('input[nevigen-audit-field-modal="title"]');
      if (field_id && field_title) {
        field_id.value = data.id ? data.id : '';
        if (data.title) {
          field_title.value = data.title;
        } else if (data.id) {
          field_title.value = data.id;
        } else {
          field_title.value = '';
        }
        field_id.setAttribute('data-item', JSON.stringify(data));

        // Set modals
        let newValue = parseInt(data.id);
        if (!newValue) {
          newValue = 0;
        }
        let modal_edit = container.querySelector('[id*="_modal_edit"]');
        if (modal_edit) {
          window.NevigenAuditFieldModal.setModalsUrlParam(modal_edit, 'id', newValue);
        }
        if (changeEvent) {
          field_id.dispatchEvent(new Event('change'));
        }
        let button_select = container.querySelector('[nevigen-audit-field-modal="button_select"]'),
          button_create = container.querySelector('[nevigen-audit-field-modal="button_create"]'),
          button_edit = container.querySelector('[nevigen-audit-field-modal="button_edit"]'),
          button_clear = container.querySelector('[nevigen-audit-field-modal="button_clear"]');
        if (button_select) {
          button_select.style.display = 'none';
        }
        if (button_create) {
          button_create.style.display = 'none';
        }
        if (button_edit) {
          button_edit.style.display = 'none';
        }
        if (button_clear) {
          button_clear.style.display = 'none';
        }
        if (displayButtons) {
          if (data.id) {
            if (button_edit) {
              button_edit.style.display = '';
            }
            if (button_clear) {
              button_clear.style.display = '';
            }
          } else {
            if (button_select) {
              button_select.style.display = '';
            }
            if (button_create) {
              button_create.style.display = '';
            }
          }
        }
        let image = container.querySelector('[nevigen-audit-field-modal="image"]');
        if (image) {
          image.src = data.image ? data.image : image.getAttribute('data-noimage');
        }
        field_id.dispatchEvent(new Event('load'));
      }
    }
  },
  setModalsUrlParam() {
    let modal = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
    let name = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
    let value = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
    if (modal) {
      if (name) {
        // Set data url
        let url = window.NevigenAuditFieldModal.replaceUrlParam(modal.getAttribute('data-url'), name, value);
        modal.setAttribute('data-url', url);

        // Set iframe
        let outer = document.createElement('div');
        outer.innerHTML = modal.getAttribute('data-iframe');
        let iframe = outer.querySelector('iframe'),
          src = window.NevigenAuditFieldModal.replaceUrlParam(iframe.getAttribute('src'), name, value);
        iframe.setAttribute('src', src);
        modal.setAttribute('data-iframe', outer.innerHTML);

        // Init modal
        let element = document.getElementById(modal.getAttribute('id'));
        Joomla.initialiseModal(element);
      }
    }
  },
  replaceUrlParam(url) {
    let name = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
    let value = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
    if (!url) {
      return '';
    }
    let searchParams = new URLSearchParams(url);
    if (value) {
      searchParams.set(name, value.toString());
    } else {
      searchParams.delete(name);
    }
    return searchParams.toString().replaceAll('%2F', '/').replaceAll('%3F', '?');
  },
  generateSelector() {
    let a = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890'.split(''),
      b = [];
    for (let i = 0; i < 32; i++) {
      let j = (Math.random() * (a.length - 1)).toFixed(0);
      b[i] = a[j];
    }
    let selector = b.join('');
    let find = document.querySelector('[nevigen-audit-field-modal="container"][data-selector="' + selector + '"]');
    if (!find) {
      return selector;
    } else {
      return this.generateSelector();
    }
  }
};
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('[nevigen-audit-field-modal="container"]').forEach(container => {
    NevigenAuditFieldModal.initialization(container);
  });
});
document.addEventListener('subform-row-add', event => {
  event.target.querySelectorAll('[nevigen-audit-field-modal="container"]').forEach(container => {
    NevigenAuditFieldModal.initialization(container);
  });
});
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoianMvZmllbGRzL21vZGFsLmpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFYTs7QUFFYkEsTUFBTSxDQUFDQyxzQkFBc0IsR0FBRztFQUMvQkMsY0FBY0EsQ0FBQ0MsU0FBUyxFQUFFO0lBQ3pCLElBQUlDLFdBQVcsR0FBR0QsU0FBUyxDQUFDRSxZQUFZLENBQUMsZUFBZSxDQUFDO01BQ3hEQyxXQUFXLEdBQUdILFNBQVMsQ0FBQ0UsWUFBWSxDQUFDLGVBQWUsQ0FBQztJQUV0RCxJQUFJRixTQUFTLENBQUNFLFlBQVksQ0FBQyxjQUFjLENBQUMsS0FBSyxPQUFPLEVBQUU7TUFDdkRDLFdBQVcsR0FBRyxJQUFJLENBQUNDLGdCQUFnQixDQUFDLENBQUM7SUFDdEM7SUFDQUosU0FBUyxDQUFDSyxZQUFZLENBQUMsZUFBZSxFQUFFRixXQUFXLENBQUM7SUFDcEQsSUFBSUgsU0FBUyxDQUFDTSxZQUFZLENBQUMsVUFBVSxDQUFDLEVBQUU7TUFDdkNOLFNBQVMsQ0FBQ0ssWUFBWSxDQUFDLFVBQVUsRUFDaENMLFNBQVMsQ0FBQ0UsWUFBWSxDQUFDLFVBQVUsQ0FBQyxDQUFDSyxVQUFVLENBQUNOLFdBQVcsRUFBRUUsV0FBVyxDQUFDLENBQUM7SUFDMUU7SUFDQUgsU0FBUyxDQUFDUSxTQUFTLEdBQUdSLFNBQVMsQ0FBQ1EsU0FBUyxDQUFDRCxVQUFVLENBQUNOLFdBQVcsRUFBRUUsV0FBVyxDQUFDO0lBRTlFSCxTQUFTLENBQUNTLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLENBQUNDLE9BQU8sQ0FBRUMsS0FBSyxJQUFLO01BQ2hFZCxNQUFNLENBQUNDLHNCQUFzQixDQUFDYyxpQkFBaUIsQ0FBQ0QsS0FBSyxFQUFFLFVBQVUsRUFBRVIsV0FBVyxDQUFDO0lBQ2hGLENBQUMsQ0FBQztJQUVGTixNQUFNLENBQUNDLHNCQUFzQixDQUFDZSxRQUFRLENBQUNWLFdBQVcsRUFBRUgsU0FBUyxDQUFDYyxhQUFhLENBQUMsdUNBQXVDLENBQUMsQ0FBQ0MsS0FBSyxFQUFFLEtBQUssQ0FBQztFQUNuSSxDQUFDO0VBRURDLFVBQVVBLENBQUNDLE9BQU8sRUFBRTtJQUNuQixJQUFJQSxPQUFPLEVBQUU7TUFDWixJQUFJQyxFQUFFLEdBQUdELE9BQU8sQ0FBQ2YsWUFBWSxDQUFDLFNBQVMsQ0FBQztRQUN2Q2lCLFFBQVEsR0FBR0YsT0FBTyxDQUFDZixZQUFZLENBQUMsZUFBZSxDQUFDO01BQ2pELElBQUlnQixFQUFFLEtBQUssSUFBSSxJQUFJQyxRQUFRLEtBQUssSUFBSSxFQUFFO1FBQ3JDdEIsTUFBTSxDQUFDQyxzQkFBc0IsQ0FBQ2UsUUFBUSxDQUFDTSxRQUFRLEVBQUVELEVBQUUsQ0FBQztNQUNyRDtJQUNEO0lBQ0EsSUFBSUUsTUFBTSxDQUFDQyxLQUFLLENBQUNDLFVBQVUsQ0FBQyxDQUFDLEVBQUU7TUFDOUJGLE1BQU0sQ0FBQ0MsS0FBSyxDQUFDQyxVQUFVLENBQUMsQ0FBQyxDQUFDQyxLQUFLLENBQUMsQ0FBQztJQUNsQztFQUNELENBQUM7RUFFREMsV0FBV0EsQ0FBQ0MsTUFBTSxFQUFlO0lBQUEsSUFBYkMsSUFBSSxHQUFBQyxTQUFBLENBQUFDLE1BQUEsUUFBQUQsU0FBQSxRQUFBRSxTQUFBLEdBQUFGLFNBQUEsTUFBRyxJQUFJO0lBQzlCLElBQUlELElBQUksS0FBSyxJQUFJLEVBQUU7TUFDbEJBLElBQUksR0FBR0QsTUFBTSxDQUFDdkIsWUFBWSxDQUFDLFdBQVcsQ0FBQztJQUN4QztJQUNBLElBQUk0QixXQUFXLEdBQUdMLE1BQU0sQ0FBQ3ZCLFlBQVksQ0FBQyxrQkFBa0IsQ0FBQztNQUN4RDZCLFFBQVEsR0FBR04sTUFBTSxDQUFDdkIsWUFBWSxDQUFDLGVBQWUsQ0FBQztNQUMvQzhCLE9BQU8sR0FBR1AsTUFBTSxDQUFDdkIsWUFBWSxDQUFDLGNBQWMsQ0FBQztNQUM3QytCLFFBQVEsR0FBR1IsTUFBTSxDQUFDdkIsWUFBWSxDQUFDLGVBQWUsQ0FBQztNQUMvQ2lCLFFBQVEsR0FBR00sTUFBTSxDQUFDdkIsWUFBWSxDQUFDLGVBQWUsQ0FBQztJQUVoRCxJQUFJRixTQUFTLEdBQUdrQyxRQUFRLENBQUNwQixhQUFhLENBQUMseURBQXlELEdBQUdLLFFBQVEsR0FBRyxJQUFJLENBQUM7SUFDbkgsSUFBSW5CLFNBQVMsSUFBSStCLFFBQVEsRUFBRTtNQUMxQixJQUFJcEIsS0FBSyxHQUFHdUIsUUFBUSxDQUFDQyxjQUFjLENBQUNKLFFBQVEsQ0FBQztRQUM1Q0ssTUFBTSxHQUFHekIsS0FBSyxDQUFDRyxhQUFhLENBQUMsUUFBUSxDQUFDO01BRXZDLElBQUlzQixNQUFNLEVBQUU7UUFDWCxJQUFJQyxTQUFTLEdBQUcxQixLQUFLLENBQUNULFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQ29DLE9BQU8sQ0FBQyxPQUFPLEVBQUUsUUFBUSxDQUFDO1FBQ25FRixNQUFNLENBQUMvQixZQUFZLENBQUMsSUFBSSxFQUFFZ0MsU0FBUyxDQUFDO1FBRXBDLElBQUlFLGNBQWMsR0FBR0gsTUFBTSxDQUFDSSxlQUFlO1FBRTNDLElBQUlDLGFBQWEsR0FBSVgsV0FBVyxHQUFJQSxXQUFXLEdBQUcsR0FBRyxHQUFHSixJQUFJLEdBQUdBLElBQUk7UUFFbkUsSUFBSUEsSUFBSSxLQUFLLFFBQVEsRUFBRTtVQUN0QlUsTUFBTSxDQUFDTSxhQUFhLENBQUN0QixNQUFNLENBQUN1QixZQUFZLENBQUNGLGFBQWEsQ0FBQztVQUN2RHJCLE1BQU0sQ0FBQ0MsS0FBSyxDQUFDQyxVQUFVLENBQUMsQ0FBQyxDQUFDQyxLQUFLLENBQUMsQ0FBQztVQUNqQyxJQUFJcUIsWUFBWSxHQUFHVixRQUFRLENBQUNwQixhQUFhLENBQUMsMkJBQTJCLENBQUM7VUFDdEUsSUFBSThCLFlBQVksRUFBRTtZQUNqQmpDLEtBQUssQ0FBQ2tDLEtBQUssQ0FBQ0MsT0FBTyxHQUFHLEVBQUU7WUFDeEJuQyxLQUFLLENBQUNvQyxTQUFTLENBQUNDLE1BQU0sQ0FBQyxNQUFNLENBQUM7WUFDOUJKLFlBQVksQ0FBQ0ksTUFBTSxDQUFDLENBQUM7WUFDckI1QixNQUFNLENBQUNDLEtBQUssQ0FBQzRCLFVBQVUsQ0FBQyxJQUFJLENBQUM7VUFDOUI7UUFDRCxDQUFDLE1BQU07VUFDTmIsTUFBTSxDQUFDYyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUdDLEtBQUssSUFBSztZQUMxQ1osY0FBYyxHQUFHWSxLQUFLLENBQUNDLE1BQU0sQ0FBQ1osZUFBZTtZQUU3QyxJQUFJYSxLQUFLLEdBQUlkLGNBQWMsR0FBSUEsY0FBYyxDQUFDSixjQUFjLENBQUNGLFFBQVEsQ0FBQyxHQUFHLEtBQUs7WUFDOUUsSUFBSW9CLEtBQUssRUFBRTtjQUNWLElBQUl0QyxLQUFLLEdBQUd1QyxRQUFRLENBQUNELEtBQUssQ0FBQ3RDLEtBQUssQ0FBQztnQkFDaEN3QyxRQUFRLEdBQUl4QyxLQUFLLElBQUlBLEtBQUssS0FBSyxDQUFFO2NBQ2xDLElBQUl3QyxRQUFRLEVBQUU7Z0JBQ2IxRCxNQUFNLENBQUNDLHNCQUFzQixDQUFDZSxRQUFRLENBQUNNLFFBQVEsRUFBRUosS0FBSyxDQUFDO2NBQ3hEO2NBRUEsSUFBSVcsSUFBSSxLQUFLLE1BQU0sRUFBRTtnQkFDcEI3QixNQUFNLENBQUNDLHNCQUFzQixDQUFDMEIsV0FBVyxDQUFDQyxNQUFNLEVBQUUsUUFBUSxDQUFDO2NBQzVEO1lBQ0Q7VUFDRCxDQUFDLENBQUM7VUFFRixJQUFJYyxjQUFjLENBQUNpQixhQUFhLENBQUNDLE9BQU8sQ0FBQ2xCLGNBQWMsQ0FBQ0osY0FBYyxDQUFDSCxPQUFPLENBQUMsQ0FBQyxFQUFFO1lBQ2pGLElBQUlOLElBQUksS0FBSyxNQUFNLEVBQUU7Y0FDcEJlLGFBQWEsR0FBSVgsV0FBVyxHQUFJQSxXQUFXLEdBQUcsUUFBUSxHQUFHLE9BQU87WUFDakU7WUFDQU0sTUFBTSxDQUFDTSxhQUFhLENBQUN0QixNQUFNLENBQUN1QixZQUFZLENBQUNGLGFBQWEsQ0FBQztVQUN4RDtRQUNEO01BQ0Q7SUFDRDtFQUNELENBQUM7RUFFRDVCLFFBQVFBLENBQUNNLFFBQVEsRUFBa0M7SUFBQSxJQUFoQ0osS0FBSyxHQUFBWSxTQUFBLENBQUFDLE1BQUEsUUFBQUQsU0FBQSxRQUFBRSxTQUFBLEdBQUFGLFNBQUEsTUFBRyxFQUFFO0lBQUEsSUFBRStCLFdBQVcsR0FBQS9CLFNBQUEsQ0FBQUMsTUFBQSxRQUFBRCxTQUFBLFFBQUFFLFNBQUEsR0FBQUYsU0FBQSxNQUFHLElBQUk7SUFDaEQsSUFBSTNCLFNBQVMsR0FBR2tDLFFBQVEsQ0FBQ3BCLGFBQWEsQ0FBQyx5REFBeUQsR0FBR0ssUUFBUSxHQUFHLElBQUksQ0FBQztJQUNuSCxJQUFJbkIsU0FBUyxFQUFFO01BQ2QsSUFBSWlDLFFBQVEsR0FBR2pDLFNBQVMsQ0FBQ2MsYUFBYSxDQUFDLHVDQUF1QyxDQUFDO1FBQzlFNkMsV0FBVyxHQUFHM0QsU0FBUyxDQUFDYyxhQUFhLENBQUMsMENBQTBDLENBQUM7TUFFbEYsSUFBSW1CLFFBQVEsSUFBSTBCLFdBQVcsRUFBRTtRQUM1QjVDLEtBQUssR0FBR3VDLFFBQVEsQ0FBQ3ZDLEtBQUssQ0FBQztRQUN2QixJQUFJd0MsUUFBUSxHQUFJeEMsS0FBSyxJQUFJQSxLQUFLLEtBQUssQ0FBRTtRQUVyQyxJQUFJNkMsSUFBSSxHQUFHO1VBQUMsSUFBSSxFQUFFN0MsS0FBSztVQUFFLE9BQU8sRUFBRTtRQUFFLENBQUM7UUFDckMsSUFBSXdDLFFBQVEsRUFBRTtVQUNiLElBQUlNLEdBQUcsR0FBRzdELFNBQVMsQ0FBQ0UsWUFBWSxDQUFDLFVBQVUsQ0FBQztVQUM1QyxJQUFJMkQsR0FBRyxLQUFLLElBQUksRUFBRTtZQUNqQkQsSUFBSSxDQUFDRSxLQUFLLEdBQUcxQyxNQUFNLENBQUMyQyxJQUFJLENBQUNDLENBQUMsQ0FBQyxnQ0FBZ0MsQ0FBQztZQUM1RG5FLE1BQU0sQ0FBQ0Msc0JBQXNCLENBQUNtRSxhQUFhLENBQUNqRSxTQUFTLEVBQUU0RCxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQztZQUMxRXhDLE1BQU0sQ0FBQzhDLE9BQU8sQ0FBQztjQUNkTCxHQUFHO2NBQ0hNLE1BQU0sRUFBRSxNQUFNO2NBQ2RQLElBQUksRUFBRVEsSUFBSSxDQUFDQyxTQUFTLENBQUNULElBQUksQ0FBQztjQUMxQlUsT0FBTyxFQUFFO2dCQUNSLGNBQWMsRUFBRTtjQUNqQixDQUFDO2NBQ0RDLFNBQVMsRUFBR0MsUUFBUSxJQUFLO2dCQUN4QixJQUFJO2tCQUNIQSxRQUFRLEdBQUdKLElBQUksQ0FBQ0ssS0FBSyxDQUFDRCxRQUFRLENBQUM7a0JBQy9CLElBQUksQ0FBQ0EsUUFBUSxDQUFDRSxPQUFPLEVBQUU7b0JBQ3RCLE1BQU0sSUFBSUMsS0FBSyxDQUFDSCxRQUFRLENBQUNJLE9BQU8sQ0FBQztrQkFDbEM7a0JBQ0EvRSxNQUFNLENBQUNDLHNCQUFzQixDQUFDbUUsYUFBYSxDQUFDakUsU0FBUyxFQUFFd0UsUUFBUSxDQUFDWixJQUFJLEVBQUVGLFdBQVcsQ0FBQztnQkFDbkYsQ0FBQyxDQUFDLE9BQU9tQixLQUFLLEVBQUU7a0JBQ2ZqQixJQUFJLENBQUMxQyxFQUFFLEdBQUcsRUFBRTtrQkFDWjBDLElBQUksQ0FBQ0UsS0FBSyxHQUFHLEVBQUU7a0JBQ2ZqRSxNQUFNLENBQUNDLHNCQUFzQixDQUFDbUUsYUFBYSxDQUFDakUsU0FBUyxFQUFFNEQsSUFBSSxFQUFFLEtBQUssQ0FBQztrQkFDbkV4QyxNQUFNLENBQUMwRCxjQUFjLENBQUM7b0JBQ3JCRCxLQUFLLEVBQUUsQ0FBQ0EsS0FBSyxDQUFDRCxPQUFPO2tCQUN0QixDQUFDLENBQUM7Z0JBQ0g7Y0FDRCxDQUFDO2NBQ0RHLE9BQU8sRUFBR0YsS0FBSyxJQUFLO2dCQUNuQmpCLElBQUksQ0FBQzFDLEVBQUUsR0FBRyxFQUFFO2dCQUNaMEMsSUFBSSxDQUFDRSxLQUFLLEdBQUcsRUFBRTtnQkFDZmpFLE1BQU0sQ0FBQ0Msc0JBQXNCLENBQUNtRSxhQUFhLENBQUNqRSxTQUFTLEVBQUU0RCxJQUFJLEVBQUUsS0FBSyxDQUFDO2dCQUNuRXhDLE1BQU0sQ0FBQzBELGNBQWMsQ0FBQztrQkFDckJELEtBQUssRUFBRSxDQUFDQSxLQUFLLENBQUNELE9BQU87Z0JBQ3RCLENBQUMsQ0FBQztjQUNIO1lBQ0QsQ0FBQyxDQUFDO1VBQ0gsQ0FBQyxNQUFNO1lBQ05oQixJQUFJLENBQUNFLEtBQUssR0FBRy9DLEtBQUs7WUFDbEJsQixNQUFNLENBQUNDLHNCQUFzQixDQUFDbUUsYUFBYSxDQUFDakUsU0FBUyxFQUFFNEQsSUFBSSxFQUFFRixXQUFXLENBQUM7VUFDMUU7UUFFRCxDQUFDLE1BQU07VUFDTjdELE1BQU0sQ0FBQ0Msc0JBQXNCLENBQUNtRSxhQUFhLENBQUNqRSxTQUFTLEVBQUU0RCxJQUFJLEVBQUVGLFdBQVcsQ0FBQztRQUMxRTtNQUNEO0lBQ0Q7RUFDRCxDQUFDO0VBRURPLGFBQWFBLENBQUEsRUFBeUU7SUFBQSxJQUF4RWpFLFNBQVMsR0FBQTJCLFNBQUEsQ0FBQUMsTUFBQSxRQUFBRCxTQUFBLFFBQUFFLFNBQUEsR0FBQUYsU0FBQSxNQUFHLElBQUk7SUFBQSxJQUFFaUMsSUFBSSxHQUFBakMsU0FBQSxDQUFBQyxNQUFBLFFBQUFELFNBQUEsUUFBQUUsU0FBQSxHQUFBRixTQUFBLE1BQUcsQ0FBQyxDQUFDO0lBQUEsSUFBRStCLFdBQVcsR0FBQS9CLFNBQUEsQ0FBQUMsTUFBQSxRQUFBRCxTQUFBLFFBQUFFLFNBQUEsR0FBQUYsU0FBQSxNQUFHLElBQUk7SUFBQSxJQUFFcUQsY0FBYyxHQUFBckQsU0FBQSxDQUFBQyxNQUFBLFFBQUFELFNBQUEsUUFBQUUsU0FBQSxHQUFBRixTQUFBLE1BQUcsSUFBSTtJQUNuRixJQUFJM0IsU0FBUyxFQUFFO01BQ2QsSUFBSWlDLFFBQVEsR0FBR2pDLFNBQVMsQ0FBQ2MsYUFBYSxDQUFDLHVDQUF1QyxDQUFDO1FBQzlFNkMsV0FBVyxHQUFHM0QsU0FBUyxDQUFDYyxhQUFhLENBQUMsMENBQTBDLENBQUM7TUFFbEYsSUFBSW1CLFFBQVEsSUFBSTBCLFdBQVcsRUFBRTtRQUM1QjFCLFFBQVEsQ0FBQ2xCLEtBQUssR0FBSTZDLElBQUksQ0FBQzFDLEVBQUUsR0FBSTBDLElBQUksQ0FBQzFDLEVBQUUsR0FBRyxFQUFFO1FBRXpDLElBQUkwQyxJQUFJLENBQUNFLEtBQUssRUFBRTtVQUNmSCxXQUFXLENBQUM1QyxLQUFLLEdBQUc2QyxJQUFJLENBQUNFLEtBQUs7UUFDL0IsQ0FBQyxNQUFNLElBQUlGLElBQUksQ0FBQzFDLEVBQUUsRUFBRTtVQUNuQnlDLFdBQVcsQ0FBQzVDLEtBQUssR0FBRzZDLElBQUksQ0FBQzFDLEVBQUU7UUFDNUIsQ0FBQyxNQUFNO1VBQ055QyxXQUFXLENBQUM1QyxLQUFLLEdBQUcsRUFBRTtRQUN2QjtRQUVBa0IsUUFBUSxDQUFDNUIsWUFBWSxDQUFDLFdBQVcsRUFBRStELElBQUksQ0FBQ0MsU0FBUyxDQUFDVCxJQUFJLENBQUMsQ0FBQzs7UUFFeEQ7UUFDQSxJQUFJcUIsUUFBUSxHQUFHM0IsUUFBUSxDQUFDTSxJQUFJLENBQUMxQyxFQUFFLENBQUM7UUFDaEMsSUFBSSxDQUFDK0QsUUFBUSxFQUFFO1VBQ2RBLFFBQVEsR0FBRyxDQUFDO1FBQ2I7UUFFQSxJQUFJQyxVQUFVLEdBQUdsRixTQUFTLENBQUNjLGFBQWEsQ0FBQyxxQkFBcUIsQ0FBQztRQUMvRCxJQUFJb0UsVUFBVSxFQUFFO1VBQ2ZyRixNQUFNLENBQUNDLHNCQUFzQixDQUFDYyxpQkFBaUIsQ0FBQ3NFLFVBQVUsRUFBRSxJQUFJLEVBQUVELFFBQVEsQ0FBQztRQUM1RTtRQUVBLElBQUl2QixXQUFXLEVBQUU7VUFDaEJ6QixRQUFRLENBQUNrRCxhQUFhLENBQUMsSUFBSUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzVDO1FBRUEsSUFBSUMsYUFBYSxHQUFHckYsU0FBUyxDQUFDYyxhQUFhLENBQUMsNkNBQTZDLENBQUM7VUFDekZ3RSxhQUFhLEdBQUd0RixTQUFTLENBQUNjLGFBQWEsQ0FBQyw2Q0FBNkMsQ0FBQztVQUN0RnlFLFdBQVcsR0FBR3ZGLFNBQVMsQ0FBQ2MsYUFBYSxDQUFDLDJDQUEyQyxDQUFDO1VBQ2xGMEUsWUFBWSxHQUFHeEYsU0FBUyxDQUFDYyxhQUFhLENBQUMsNENBQTRDLENBQUM7UUFFckYsSUFBSXVFLGFBQWEsRUFBRTtVQUNsQkEsYUFBYSxDQUFDeEMsS0FBSyxDQUFDQyxPQUFPLEdBQUcsTUFBTTtRQUNyQztRQUNBLElBQUl3QyxhQUFhLEVBQUU7VUFDbEJBLGFBQWEsQ0FBQ3pDLEtBQUssQ0FBQ0MsT0FBTyxHQUFHLE1BQU07UUFDckM7UUFDQSxJQUFJeUMsV0FBVyxFQUFFO1VBQ2hCQSxXQUFXLENBQUMxQyxLQUFLLENBQUNDLE9BQU8sR0FBRyxNQUFNO1FBQ25DO1FBQ0EsSUFBSTBDLFlBQVksRUFBRTtVQUNqQkEsWUFBWSxDQUFDM0MsS0FBSyxDQUFDQyxPQUFPLEdBQUcsTUFBTTtRQUNwQztRQUVBLElBQUlrQyxjQUFjLEVBQUU7VUFDbkIsSUFBSXBCLElBQUksQ0FBQzFDLEVBQUUsRUFBRTtZQUNaLElBQUlxRSxXQUFXLEVBQUU7Y0FDaEJBLFdBQVcsQ0FBQzFDLEtBQUssQ0FBQ0MsT0FBTyxHQUFHLEVBQUU7WUFDL0I7WUFDQSxJQUFJMEMsWUFBWSxFQUFFO2NBQ2pCQSxZQUFZLENBQUMzQyxLQUFLLENBQUNDLE9BQU8sR0FBRyxFQUFFO1lBQ2hDO1VBQ0QsQ0FBQyxNQUFNO1lBQ04sSUFBSXVDLGFBQWEsRUFBRTtjQUNsQkEsYUFBYSxDQUFDeEMsS0FBSyxDQUFDQyxPQUFPLEdBQUcsRUFBRTtZQUNqQztZQUNBLElBQUl3QyxhQUFhLEVBQUU7Y0FDbEJBLGFBQWEsQ0FBQ3pDLEtBQUssQ0FBQ0MsT0FBTyxHQUFHLEVBQUU7WUFDakM7VUFDRDtRQUNEO1FBRUEsSUFBSTJDLEtBQUssR0FBR3pGLFNBQVMsQ0FBQ2MsYUFBYSxDQUFDLHFDQUFxQyxDQUFDO1FBQzFFLElBQUkyRSxLQUFLLEVBQUU7VUFDVkEsS0FBSyxDQUFDQyxHQUFHLEdBQUk5QixJQUFJLENBQUM2QixLQUFLLEdBQUk3QixJQUFJLENBQUM2QixLQUFLLEdBQUdBLEtBQUssQ0FBQ3ZGLFlBQVksQ0FBQyxjQUFjLENBQUM7UUFDM0U7UUFFQStCLFFBQVEsQ0FBQ2tELGFBQWEsQ0FBQyxJQUFJQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7TUFDMUM7SUFDRDtFQUNELENBQUM7RUFFRHhFLGlCQUFpQkEsQ0FBQSxFQUEwQztJQUFBLElBQXpDRCxLQUFLLEdBQUFnQixTQUFBLENBQUFDLE1BQUEsUUFBQUQsU0FBQSxRQUFBRSxTQUFBLEdBQUFGLFNBQUEsTUFBRyxJQUFJO0lBQUEsSUFBRWdFLElBQUksR0FBQWhFLFNBQUEsQ0FBQUMsTUFBQSxRQUFBRCxTQUFBLFFBQUFFLFNBQUEsR0FBQUYsU0FBQSxNQUFHLElBQUk7SUFBQSxJQUFFWixLQUFLLEdBQUFZLFNBQUEsQ0FBQUMsTUFBQSxRQUFBRCxTQUFBLFFBQUFFLFNBQUEsR0FBQUYsU0FBQSxNQUFHLElBQUk7SUFDeEQsSUFBSWhCLEtBQUssRUFBRTtNQUNWLElBQUlnRixJQUFJLEVBQUU7UUFDVDtRQUNBLElBQUk5QixHQUFHLEdBQUdoRSxNQUFNLENBQUNDLHNCQUFzQixDQUFDOEYsZUFBZSxDQUFDakYsS0FBSyxDQUFDVCxZQUFZLENBQUMsVUFBVSxDQUFDLEVBQUV5RixJQUFJLEVBQUU1RSxLQUFLLENBQUM7UUFDcEdKLEtBQUssQ0FBQ04sWUFBWSxDQUFDLFVBQVUsRUFBRXdELEdBQUcsQ0FBQzs7UUFFbkM7UUFDQSxJQUFJZ0MsS0FBSyxHQUFHM0QsUUFBUSxDQUFDNEQsYUFBYSxDQUFDLEtBQUssQ0FBQztRQUN6Q0QsS0FBSyxDQUFDckYsU0FBUyxHQUFHRyxLQUFLLENBQUNULFlBQVksQ0FBQyxhQUFhLENBQUM7UUFFbkQsSUFBSWtDLE1BQU0sR0FBR3lELEtBQUssQ0FBQy9FLGFBQWEsQ0FBQyxRQUFRLENBQUM7VUFDekM0RSxHQUFHLEdBQUc3RixNQUFNLENBQUNDLHNCQUFzQixDQUFDOEYsZUFBZSxDQUFDeEQsTUFBTSxDQUFDbEMsWUFBWSxDQUFDLEtBQUssQ0FBQyxFQUFFeUYsSUFBSSxFQUFFNUUsS0FBSyxDQUFDO1FBRTdGcUIsTUFBTSxDQUFDL0IsWUFBWSxDQUFDLEtBQUssRUFBRXFGLEdBQUcsQ0FBQztRQUMvQi9FLEtBQUssQ0FBQ04sWUFBWSxDQUFDLGFBQWEsRUFBRXdGLEtBQUssQ0FBQ3JGLFNBQVMsQ0FBQzs7UUFFbEQ7UUFDQSxJQUFJUyxPQUFPLEdBQUdpQixRQUFRLENBQUNDLGNBQWMsQ0FBQ3hCLEtBQUssQ0FBQ1QsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQy9Ea0IsTUFBTSxDQUFDMkUsZUFBZSxDQUFDOUUsT0FBTyxDQUFDO01BQ2hDO0lBQ0Q7RUFDRCxDQUFDO0VBRUQyRSxlQUFlQSxDQUFDL0IsR0FBRyxFQUE2QjtJQUFBLElBQTNCOEIsSUFBSSxHQUFBaEUsU0FBQSxDQUFBQyxNQUFBLFFBQUFELFNBQUEsUUFBQUUsU0FBQSxHQUFBRixTQUFBLE1BQUcsSUFBSTtJQUFBLElBQUVaLEtBQUssR0FBQVksU0FBQSxDQUFBQyxNQUFBLFFBQUFELFNBQUEsUUFBQUUsU0FBQSxHQUFBRixTQUFBLE1BQUcsSUFBSTtJQUM3QyxJQUFJLENBQUNrQyxHQUFHLEVBQUU7TUFDVCxPQUFPLEVBQUU7SUFDVjtJQUVBLElBQUltQyxZQUFZLEdBQUcsSUFBSUMsZUFBZSxDQUFDcEMsR0FBRyxDQUFDO0lBQzNDLElBQUk5QyxLQUFLLEVBQUU7TUFDVmlGLFlBQVksQ0FBQ0UsR0FBRyxDQUFDUCxJQUFJLEVBQUU1RSxLQUFLLENBQUNvRixRQUFRLENBQUMsQ0FBQyxDQUFDO0lBQ3pDLENBQUMsTUFBTTtNQUNOSCxZQUFZLENBQUNJLE1BQU0sQ0FBQ1QsSUFBSSxDQUFDO0lBQzFCO0lBRUEsT0FBT0ssWUFBWSxDQUFDRyxRQUFRLENBQUMsQ0FBQyxDQUM1QjVGLFVBQVUsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQ3RCQSxVQUFVLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQztFQUN6QixDQUFDO0VBRURILGdCQUFnQkEsQ0FBQSxFQUFHO0lBQ2xCLElBQUlpRyxDQUFDLEdBQUcsZ0VBQWdFLENBQUNDLEtBQUssQ0FBQyxFQUFFLENBQUM7TUFDakZDLENBQUMsR0FBRyxFQUFFO0lBQ1AsS0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUcsRUFBRSxFQUFFQSxDQUFDLEVBQUUsRUFBRTtNQUM1QixJQUFJQyxDQUFDLEdBQUcsQ0FBQ0MsSUFBSSxDQUFDQyxNQUFNLENBQUMsQ0FBQyxJQUFJTixDQUFDLENBQUN6RSxNQUFNLEdBQUcsQ0FBQyxDQUFDLEVBQUVnRixPQUFPLENBQUMsQ0FBQyxDQUFDO01BQ25ETCxDQUFDLENBQUNDLENBQUMsQ0FBQyxHQUFHSCxDQUFDLENBQUNJLENBQUMsQ0FBQztJQUNaO0lBQ0EsSUFBSXRGLFFBQVEsR0FBR29GLENBQUMsQ0FBQ00sSUFBSSxDQUFDLEVBQUUsQ0FBQztJQUV6QixJQUFJQyxJQUFJLEdBQUc1RSxRQUFRLENBQUNwQixhQUFhLENBQUMseURBQXlELEdBQUdLLFFBQVEsR0FBRyxJQUFJLENBQUM7SUFDOUcsSUFBSSxDQUFDMkYsSUFBSSxFQUFFO01BQ1YsT0FBTzNGLFFBQVE7SUFDaEIsQ0FBQyxNQUFNO01BQ04sT0FBTyxJQUFJLENBQUNmLGdCQUFnQixDQUFDLENBQUM7SUFDL0I7RUFDRDtBQUNELENBQUM7QUFFRDhCLFFBQVEsQ0FBQ2dCLGdCQUFnQixDQUFDLGtCQUFrQixFQUFFLE1BQU07RUFDbkRoQixRQUFRLENBQUN6QixnQkFBZ0IsQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFDQyxPQUFPLENBQUVWLFNBQVMsSUFBSztJQUMzRkYsc0JBQXNCLENBQUNDLGNBQWMsQ0FBQ0MsU0FBUyxDQUFDO0VBQ2pELENBQUMsQ0FBQztBQUNILENBQUMsQ0FBQztBQUNGa0MsUUFBUSxDQUFDZ0IsZ0JBQWdCLENBQUMsaUJBQWlCLEVBQUdDLEtBQUssSUFBSztFQUN2REEsS0FBSyxDQUFDQyxNQUFNLENBQUMzQyxnQkFBZ0IsQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFDQyxPQUFPLENBQUVWLFNBQVMsSUFBSztJQUMvRkYsc0JBQXNCLENBQUNDLGNBQWMsQ0FBQ0MsU0FBUyxDQUFDO0VBQ2pELENBQUMsQ0FBQztBQUNILENBQUMsQ0FBQyxDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcGtnX25ldmlnZW5fYXVkaXQvLi9jb21fbmV2aWdlbl9hdWRpdC9lczYvZmllbGRzL21vZGFsLmVzNiJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQHBhY2thZ2UgICAgTmV2aWdlbiBBdWRpdCBQYWNrYWdlXG4gKiBAdmVyc2lvbiAgICAxLjAuN1xuICogQGF1dGhvciAgICAgTmV2aWdlbi5jb20gLSBodHRwczovL25ldmlnZW4uY29tXG4gKiBAY29weXJpZ2h0ICBDb3B5cmlnaHQgwqkgTmV2aWdlbi5jb20uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBAbGljZW5zZSAgICBQcm9wcmlldGFyeS4gQ29weXJpZ2h0ZWQgQ29tbWVyY2lhbCBTb2Z0d2FyZVxuICogQGxpbmsgICAgICAgaHR0cHM6Ly9uZXZpZ2VuLmNvbVxuICovXG5cblwidXNlIHN0cmljdFwiO1xuXG53aW5kb3cuTmV2aWdlbkF1ZGl0RmllbGRNb2RhbCA9IHtcblx0aW5pdGlhbGl6YXRpb24oY29udGFpbmVyKSB7XG5cdFx0bGV0IG9sZFNlbGVjdG9yID0gY29udGFpbmVyLmdldEF0dHJpYnV0ZSgnZGF0YS1zZWxlY3RvcicpLFxuXHRcdFx0bmV3U2VsZWN0b3IgPSBjb250YWluZXIuZ2V0QXR0cmlidXRlKCdkYXRhLXNlbGVjdG9yJyk7XG5cblx0XHRpZiAoY29udGFpbmVyLmdldEF0dHJpYnV0ZSgnZGF0YS1keW5hbWljJykgIT09ICdmYWxzZScpIHtcblx0XHRcdG5ld1NlbGVjdG9yID0gdGhpcy5nZW5lcmF0ZVNlbGVjdG9yKCk7XG5cdFx0fVxuXHRcdGNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2RhdGEtc2VsZWN0b3InLCBuZXdTZWxlY3Rvcik7XG5cdFx0aWYgKGNvbnRhaW5lci5oYXNBdHRyaWJ1dGUoJ2RhdGEtZ2V0JykpIHtcblx0XHRcdGNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2RhdGEtZ2V0Jyxcblx0XHRcdFx0Y29udGFpbmVyLmdldEF0dHJpYnV0ZSgnZGF0YS1nZXQnKS5yZXBsYWNlQWxsKG9sZFNlbGVjdG9yLCBuZXdTZWxlY3RvcikpO1xuXHRcdH1cblx0XHRjb250YWluZXIuaW5uZXJIVE1MID0gY29udGFpbmVyLmlubmVySFRNTC5yZXBsYWNlQWxsKG9sZFNlbGVjdG9yLCBuZXdTZWxlY3Rvcik7XG5cblx0XHRjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnW2lkKj1cIl9tb2RhbF9cIl0nKS5mb3JFYWNoKChtb2RhbCkgPT4ge1xuXHRcdFx0d2luZG93Lk5ldmlnZW5BdWRpdEZpZWxkTW9kYWwuc2V0TW9kYWxzVXJsUGFyYW0obW9kYWwsICdzZWxlY3RvcicsIG5ld1NlbGVjdG9yKTtcblx0XHR9KTtcblxuXHRcdHdpbmRvdy5OZXZpZ2VuQXVkaXRGaWVsZE1vZGFsLnNldFZhbHVlKG5ld1NlbGVjdG9yLCBjb250YWluZXIucXVlcnlTZWxlY3RvcignaW5wdXRbbmV2aWdlbi1hdWRpdC1maWVsZC1tb2RhbD1cImlkXCJdJykudmFsdWUsIGZhbHNlKTtcblx0fSxcblxuXHRzZWxlY3RJdGVtKGVsZW1lbnQpIHtcblx0XHRpZiAoZWxlbWVudCkge1xuXHRcdFx0bGV0IGlkID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKSxcblx0XHRcdFx0c2VsZWN0b3IgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1zZWxlY3RvcicpO1xuXHRcdFx0aWYgKGlkICE9PSBudWxsICYmIHNlbGVjdG9yICE9PSBudWxsKSB7XG5cdFx0XHRcdHdpbmRvdy5OZXZpZ2VuQXVkaXRGaWVsZE1vZGFsLnNldFZhbHVlKHNlbGVjdG9yLCBpZCk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChKb29tbGEuTW9kYWwuZ2V0Q3VycmVudCgpKSB7XG5cdFx0XHRKb29tbGEuTW9kYWwuZ2V0Q3VycmVudCgpLmNsb3NlKCk7XG5cdFx0fVxuXHR9LFxuXG5cdHByb2Nlc3NJdGVtKGJ1dHRvbiwgdGFzayA9IG51bGwpIHtcblx0XHRpZiAodGFzayA9PT0gbnVsbCkge1xuXHRcdFx0dGFzayA9IGJ1dHRvbi5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGFzaycpO1xuXHRcdH1cblx0XHRsZXQgdGFza19wcmVmaXggPSBidXR0b24uZ2V0QXR0cmlidXRlKCdkYXRhLXRhc2tfcHJlZml4JyksXG5cdFx0XHRtb2RhbF9pZCA9IGJ1dHRvbi5nZXRBdHRyaWJ1dGUoJ2RhdGEtbW9kYWxfaWQnKSxcblx0XHRcdGZvcm1faWQgPSBidXR0b24uZ2V0QXR0cmlidXRlKCdkYXRhLWZvcm1faWQnKSxcblx0XHRcdGZpZWxkX2lkID0gYnV0dG9uLmdldEF0dHJpYnV0ZSgnZGF0YS1maWVsZF9pZCcpLFxuXHRcdFx0c2VsZWN0b3IgPSBidXR0b24uZ2V0QXR0cmlidXRlKCdkYXRhLXNlbGVjdG9yJyk7XG5cblx0XHRsZXQgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW25ldmlnZW4tYXVkaXQtZmllbGQtbW9kYWw9XCJjb250YWluZXJcIl1bZGF0YS1zZWxlY3Rvcj1cIicgKyBzZWxlY3RvciArICdcIl0nKTtcblx0XHRpZiAoY29udGFpbmVyICYmIG1vZGFsX2lkKSB7XG5cdFx0XHRsZXQgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtb2RhbF9pZCksXG5cdFx0XHRcdGlmcmFtZSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJ2lmcmFtZScpO1xuXG5cdFx0XHRpZiAoaWZyYW1lKSB7XG5cdFx0XHRcdGxldCBpZnJhbWVfaWQgPSBtb2RhbC5nZXRBdHRyaWJ1dGUoJ2lkJykucmVwbGFjZSgnbW9kYWwnLCAnaWZyYW1lJyk7XG5cdFx0XHRcdGlmcmFtZS5zZXRBdHRyaWJ1dGUoJ2lkJywgaWZyYW1lX2lkKTtcblxuXHRcdFx0XHRsZXQgaWZyYW1lRG9jdW1lbnQgPSBpZnJhbWUuY29udGVudERvY3VtZW50O1xuXG5cdFx0XHRcdGxldCBzdWJtaXR0ZWRUYXNrID0gKHRhc2tfcHJlZml4KSA/IHRhc2tfcHJlZml4ICsgJy4nICsgdGFzayA6IHRhc2s7XG5cblx0XHRcdFx0aWYgKHRhc2sgPT09ICdjYW5jZWwnKSB7XG5cdFx0XHRcdFx0aWZyYW1lLmNvbnRlbnRXaW5kb3cuSm9vbWxhLnN1Ym1pdGJ1dHRvbihzdWJtaXR0ZWRUYXNrKTtcblx0XHRcdFx0XHRKb29tbGEuTW9kYWwuZ2V0Q3VycmVudCgpLmNsb3NlKCk7XG5cdFx0XHRcdFx0bGV0IG1vZGFsT3ZlcmxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC1iYWNrZHJvcC5mYWRlLnNob3cnKTtcblx0XHRcdFx0XHRpZiAobW9kYWxPdmVybGF5KSB7XG5cdFx0XHRcdFx0XHRtb2RhbC5zdHlsZS5kaXNwbGF5ID0gJyc7XG5cdFx0XHRcdFx0XHRtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG5cdFx0XHRcdFx0XHRtb2RhbE92ZXJsYXkucmVtb3ZlKCk7XG5cdFx0XHRcdFx0XHRKb29tbGEuTW9kYWwuc2V0Q3VycmVudChudWxsKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aWZyYW1lLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoZXZlbnQpID0+IHtcblx0XHRcdFx0XHRcdGlmcmFtZURvY3VtZW50ID0gZXZlbnQudGFyZ2V0LmNvbnRlbnREb2N1bWVudDtcblxuXHRcdFx0XHRcdFx0bGV0IGZpZWxkID0gKGlmcmFtZURvY3VtZW50KSA/IGlmcmFtZURvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZpZWxkX2lkKSA6IGZhbHNlO1xuXHRcdFx0XHRcdFx0aWYgKGZpZWxkKSB7XG5cdFx0XHRcdFx0XHRcdGxldCB2YWx1ZSA9IHBhcnNlSW50KGZpZWxkLnZhbHVlKSxcblx0XHRcdFx0XHRcdFx0XHRoYXNWYWx1ZSA9ICh2YWx1ZSAmJiB2YWx1ZSAhPT0gMCk7XG5cdFx0XHRcdFx0XHRcdGlmIChoYXNWYWx1ZSkge1xuXHRcdFx0XHRcdFx0XHRcdHdpbmRvdy5OZXZpZ2VuQXVkaXRGaWVsZE1vZGFsLnNldFZhbHVlKHNlbGVjdG9yLCB2YWx1ZSk7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRpZiAodGFzayA9PT0gJ3NhdmUnKSB7XG5cdFx0XHRcdFx0XHRcdFx0d2luZG93Lk5ldmlnZW5BdWRpdEZpZWxkTW9kYWwucHJvY2Vzc0l0ZW0oYnV0dG9uLCAnY2FuY2VsJyk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdGlmIChpZnJhbWVEb2N1bWVudC5mb3JtdmFsaWRhdG9yLmlzVmFsaWQoaWZyYW1lRG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZm9ybV9pZCkpKSB7XG5cdFx0XHRcdFx0XHRpZiAodGFzayA9PT0gJ3NhdmUnKSB7XG5cdFx0XHRcdFx0XHRcdHN1Ym1pdHRlZFRhc2sgPSAodGFza19wcmVmaXgpID8gdGFza19wcmVmaXggKyAnLmFwcGx5JyA6ICdhcHBseSc7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRpZnJhbWUuY29udGVudFdpbmRvdy5Kb29tbGEuc3VibWl0YnV0dG9uKHN1Ym1pdHRlZFRhc2spO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fSxcblxuXHRzZXRWYWx1ZShzZWxlY3RvciwgdmFsdWUgPSAnJywgY2hhbmdlRXZlbnQgPSB0cnVlKSB7XG5cdFx0bGV0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuZXZpZ2VuLWF1ZGl0LWZpZWxkLW1vZGFsPVwiY29udGFpbmVyXCJdW2RhdGEtc2VsZWN0b3I9XCInICsgc2VsZWN0b3IgKyAnXCJdJyk7XG5cdFx0aWYgKGNvbnRhaW5lcikge1xuXHRcdFx0bGV0IGZpZWxkX2lkID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25ldmlnZW4tYXVkaXQtZmllbGQtbW9kYWw9XCJpZFwiXScpLFxuXHRcdFx0XHRmaWVsZF90aXRsZSA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuZXZpZ2VuLWF1ZGl0LWZpZWxkLW1vZGFsPVwidGl0bGVcIl0nKTtcblxuXHRcdFx0aWYgKGZpZWxkX2lkICYmIGZpZWxkX3RpdGxlKSB7XG5cdFx0XHRcdHZhbHVlID0gcGFyc2VJbnQodmFsdWUpO1xuXHRcdFx0XHRsZXQgaGFzVmFsdWUgPSAodmFsdWUgJiYgdmFsdWUgIT09IDApO1xuXG5cdFx0XHRcdGxldCBkYXRhID0geydpZCc6IHZhbHVlLCAndGl0bGUnOiAnJ307XG5cdFx0XHRcdGlmIChoYXNWYWx1ZSkge1xuXHRcdFx0XHRcdGxldCB1cmwgPSBjb250YWluZXIuZ2V0QXR0cmlidXRlKCdkYXRhLWdldCcpO1xuXHRcdFx0XHRcdGlmICh1cmwgIT09IG51bGwpIHtcblx0XHRcdFx0XHRcdGRhdGEudGl0bGUgPSBKb29tbGEuVGV4dC5fKCdDT01fTkVWSUdFTl9BVURJVF9BSkFYX0xPQURJTkcnKTtcblx0XHRcdFx0XHRcdHdpbmRvdy5OZXZpZ2VuQXVkaXRGaWVsZE1vZGFsLnNldEZpZWxkVmFsdWUoY29udGFpbmVyLCBkYXRhLCBmYWxzZSwgZmFsc2UpO1xuXHRcdFx0XHRcdFx0Sm9vbWxhLnJlcXVlc3Qoe1xuXHRcdFx0XHRcdFx0XHR1cmwsXG5cdFx0XHRcdFx0XHRcdG1ldGhvZDogJ1BPU1QnLFxuXHRcdFx0XHRcdFx0XHRkYXRhOiBKU09OLnN0cmluZ2lmeShkYXRhKSxcblx0XHRcdFx0XHRcdFx0aGVhZGVyczoge1xuXHRcdFx0XHRcdFx0XHRcdCdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcblx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0b25TdWNjZXNzOiAocmVzcG9uc2UpID0+IHtcblx0XHRcdFx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmVzcG9uc2UgPSBKU09OLnBhcnNlKHJlc3BvbnNlKTtcblx0XHRcdFx0XHRcdFx0XHRcdGlmICghcmVzcG9uc2Uuc3VjY2Vzcykge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IocmVzcG9uc2UubWVzc2FnZSk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHR3aW5kb3cuTmV2aWdlbkF1ZGl0RmllbGRNb2RhbC5zZXRGaWVsZFZhbHVlKGNvbnRhaW5lciwgcmVzcG9uc2UuZGF0YSwgY2hhbmdlRXZlbnQpO1xuXHRcdFx0XHRcdFx0XHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRkYXRhLmlkID0gJyc7XG5cdFx0XHRcdFx0XHRcdFx0XHRkYXRhLnRpdGxlID0gJyc7XG5cdFx0XHRcdFx0XHRcdFx0XHR3aW5kb3cuTmV2aWdlbkF1ZGl0RmllbGRNb2RhbC5zZXRGaWVsZFZhbHVlKGNvbnRhaW5lciwgZGF0YSwgZmFsc2UpO1xuXHRcdFx0XHRcdFx0XHRcdFx0Sm9vbWxhLnJlbmRlck1lc3NhZ2VzKHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0ZXJyb3I6IFtlcnJvci5tZXNzYWdlXVxuXHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0XHRvbkVycm9yOiAoZXJyb3IpID0+IHtcblx0XHRcdFx0XHRcdFx0XHRkYXRhLmlkID0gJyc7XG5cdFx0XHRcdFx0XHRcdFx0ZGF0YS50aXRsZSA9ICcnO1xuXHRcdFx0XHRcdFx0XHRcdHdpbmRvdy5OZXZpZ2VuQXVkaXRGaWVsZE1vZGFsLnNldEZpZWxkVmFsdWUoY29udGFpbmVyLCBkYXRhLCBmYWxzZSk7XG5cdFx0XHRcdFx0XHRcdFx0Sm9vbWxhLnJlbmRlck1lc3NhZ2VzKHtcblx0XHRcdFx0XHRcdFx0XHRcdGVycm9yOiBbZXJyb3IubWVzc2FnZV1cblx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGRhdGEudGl0bGUgPSB2YWx1ZTtcblx0XHRcdFx0XHRcdHdpbmRvdy5OZXZpZ2VuQXVkaXRGaWVsZE1vZGFsLnNldEZpZWxkVmFsdWUoY29udGFpbmVyLCBkYXRhLCBjaGFuZ2VFdmVudCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0d2luZG93Lk5ldmlnZW5BdWRpdEZpZWxkTW9kYWwuc2V0RmllbGRWYWx1ZShjb250YWluZXIsIGRhdGEsIGNoYW5nZUV2ZW50KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fSxcblxuXHRzZXRGaWVsZFZhbHVlKGNvbnRhaW5lciA9IG51bGwsIGRhdGEgPSB7fSwgY2hhbmdlRXZlbnQgPSB0cnVlLCBkaXNwbGF5QnV0dG9ucyA9IHRydWUpIHtcblx0XHRpZiAoY29udGFpbmVyKSB7XG5cdFx0XHRsZXQgZmllbGRfaWQgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignaW5wdXRbbmV2aWdlbi1hdWRpdC1maWVsZC1tb2RhbD1cImlkXCJdJyksXG5cdFx0XHRcdGZpZWxkX3RpdGxlID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25ldmlnZW4tYXVkaXQtZmllbGQtbW9kYWw9XCJ0aXRsZVwiXScpO1xuXG5cdFx0XHRpZiAoZmllbGRfaWQgJiYgZmllbGRfdGl0bGUpIHtcblx0XHRcdFx0ZmllbGRfaWQudmFsdWUgPSAoZGF0YS5pZCkgPyBkYXRhLmlkIDogJyc7XG5cblx0XHRcdFx0aWYgKGRhdGEudGl0bGUpIHtcblx0XHRcdFx0XHRmaWVsZF90aXRsZS52YWx1ZSA9IGRhdGEudGl0bGU7XG5cdFx0XHRcdH0gZWxzZSBpZiAoZGF0YS5pZCkge1xuXHRcdFx0XHRcdGZpZWxkX3RpdGxlLnZhbHVlID0gZGF0YS5pZDtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRmaWVsZF90aXRsZS52YWx1ZSA9ICcnO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZmllbGRfaWQuc2V0QXR0cmlidXRlKCdkYXRhLWl0ZW0nLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG5cblx0XHRcdFx0Ly8gU2V0IG1vZGFsc1xuXHRcdFx0XHRsZXQgbmV3VmFsdWUgPSBwYXJzZUludChkYXRhLmlkKTtcblx0XHRcdFx0aWYgKCFuZXdWYWx1ZSkge1xuXHRcdFx0XHRcdG5ld1ZhbHVlID0gMDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGxldCBtb2RhbF9lZGl0ID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ1tpZCo9XCJfbW9kYWxfZWRpdFwiXScpO1xuXHRcdFx0XHRpZiAobW9kYWxfZWRpdCkge1xuXHRcdFx0XHRcdHdpbmRvdy5OZXZpZ2VuQXVkaXRGaWVsZE1vZGFsLnNldE1vZGFsc1VybFBhcmFtKG1vZGFsX2VkaXQsICdpZCcsIG5ld1ZhbHVlKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChjaGFuZ2VFdmVudCkge1xuXHRcdFx0XHRcdGZpZWxkX2lkLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdjaGFuZ2UnKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRsZXQgYnV0dG9uX3NlbGVjdCA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdbbmV2aWdlbi1hdWRpdC1maWVsZC1tb2RhbD1cImJ1dHRvbl9zZWxlY3RcIl0nKSxcblx0XHRcdFx0XHRidXR0b25fY3JlYXRlID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ1tuZXZpZ2VuLWF1ZGl0LWZpZWxkLW1vZGFsPVwiYnV0dG9uX2NyZWF0ZVwiXScpLFxuXHRcdFx0XHRcdGJ1dHRvbl9lZGl0ID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ1tuZXZpZ2VuLWF1ZGl0LWZpZWxkLW1vZGFsPVwiYnV0dG9uX2VkaXRcIl0nKSxcblx0XHRcdFx0XHRidXR0b25fY2xlYXIgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignW25ldmlnZW4tYXVkaXQtZmllbGQtbW9kYWw9XCJidXR0b25fY2xlYXJcIl0nKTtcblxuXHRcdFx0XHRpZiAoYnV0dG9uX3NlbGVjdCkge1xuXHRcdFx0XHRcdGJ1dHRvbl9zZWxlY3Quc3R5bGUuZGlzcGxheSA9ICdub25lJztcblx0XHRcdFx0fVxuXHRcdFx0XHRpZiAoYnV0dG9uX2NyZWF0ZSkge1xuXHRcdFx0XHRcdGJ1dHRvbl9jcmVhdGUuc3R5bGUuZGlzcGxheSA9ICdub25lJztcblx0XHRcdFx0fVxuXHRcdFx0XHRpZiAoYnV0dG9uX2VkaXQpIHtcblx0XHRcdFx0XHRidXR0b25fZWRpdC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmIChidXR0b25fY2xlYXIpIHtcblx0XHRcdFx0XHRidXR0b25fY2xlYXIuc3R5bGUuZGlzcGxheSA9ICdub25lJztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChkaXNwbGF5QnV0dG9ucykge1xuXHRcdFx0XHRcdGlmIChkYXRhLmlkKSB7XG5cdFx0XHRcdFx0XHRpZiAoYnV0dG9uX2VkaXQpIHtcblx0XHRcdFx0XHRcdFx0YnV0dG9uX2VkaXQuc3R5bGUuZGlzcGxheSA9ICcnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0aWYgKGJ1dHRvbl9jbGVhcikge1xuXHRcdFx0XHRcdFx0XHRidXR0b25fY2xlYXIuc3R5bGUuZGlzcGxheSA9ICcnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRpZiAoYnV0dG9uX3NlbGVjdCkge1xuXHRcdFx0XHRcdFx0XHRidXR0b25fc2VsZWN0LnN0eWxlLmRpc3BsYXkgPSAnJztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGlmIChidXR0b25fY3JlYXRlKSB7XG5cdFx0XHRcdFx0XHRcdGJ1dHRvbl9jcmVhdGUuc3R5bGUuZGlzcGxheSA9ICcnO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGxldCBpbWFnZSA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdbbmV2aWdlbi1hdWRpdC1maWVsZC1tb2RhbD1cImltYWdlXCJdJyk7XG5cdFx0XHRcdGlmIChpbWFnZSkge1xuXHRcdFx0XHRcdGltYWdlLnNyYyA9IChkYXRhLmltYWdlKSA/IGRhdGEuaW1hZ2UgOiBpbWFnZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtbm9pbWFnZScpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZmllbGRfaWQuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2xvYWQnKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9LFxuXG5cdHNldE1vZGFsc1VybFBhcmFtKG1vZGFsID0gbnVsbCwgbmFtZSA9IG51bGwsIHZhbHVlID0gbnVsbCkge1xuXHRcdGlmIChtb2RhbCkge1xuXHRcdFx0aWYgKG5hbWUpIHtcblx0XHRcdFx0Ly8gU2V0IGRhdGEgdXJsXG5cdFx0XHRcdGxldCB1cmwgPSB3aW5kb3cuTmV2aWdlbkF1ZGl0RmllbGRNb2RhbC5yZXBsYWNlVXJsUGFyYW0obW9kYWwuZ2V0QXR0cmlidXRlKCdkYXRhLXVybCcpLCBuYW1lLCB2YWx1ZSk7XG5cdFx0XHRcdG1vZGFsLnNldEF0dHJpYnV0ZSgnZGF0YS11cmwnLCB1cmwpO1xuXG5cdFx0XHRcdC8vIFNldCBpZnJhbWVcblx0XHRcdFx0bGV0IG91dGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cdFx0XHRcdG91dGVyLmlubmVySFRNTCA9IG1vZGFsLmdldEF0dHJpYnV0ZSgnZGF0YS1pZnJhbWUnKTtcblxuXHRcdFx0XHRsZXQgaWZyYW1lID0gb3V0ZXIucXVlcnlTZWxlY3RvcignaWZyYW1lJyksXG5cdFx0XHRcdFx0c3JjID0gd2luZG93Lk5ldmlnZW5BdWRpdEZpZWxkTW9kYWwucmVwbGFjZVVybFBhcmFtKGlmcmFtZS5nZXRBdHRyaWJ1dGUoJ3NyYycpLCBuYW1lLCB2YWx1ZSk7XG5cblx0XHRcdFx0aWZyYW1lLnNldEF0dHJpYnV0ZSgnc3JjJywgc3JjKTtcblx0XHRcdFx0bW9kYWwuc2V0QXR0cmlidXRlKCdkYXRhLWlmcmFtZScsIG91dGVyLmlubmVySFRNTCk7XG5cblx0XHRcdFx0Ly8gSW5pdCBtb2RhbFxuXHRcdFx0XHRsZXQgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vZGFsLmdldEF0dHJpYnV0ZSgnaWQnKSk7XG5cdFx0XHRcdEpvb21sYS5pbml0aWFsaXNlTW9kYWwoZWxlbWVudCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9LFxuXG5cdHJlcGxhY2VVcmxQYXJhbSh1cmwsIG5hbWUgPSBudWxsLCB2YWx1ZSA9IG51bGwpIHtcblx0XHRpZiAoIXVybCkge1xuXHRcdFx0cmV0dXJuICcnO1xuXHRcdH1cblxuXHRcdGxldCBzZWFyY2hQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHVybCk7XG5cdFx0aWYgKHZhbHVlKSB7XG5cdFx0XHRzZWFyY2hQYXJhbXMuc2V0KG5hbWUsIHZhbHVlLnRvU3RyaW5nKCkpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRzZWFyY2hQYXJhbXMuZGVsZXRlKG5hbWUpO1xuXHRcdH1cblxuXHRcdHJldHVybiBzZWFyY2hQYXJhbXMudG9TdHJpbmcoKVxuXHRcdFx0LnJlcGxhY2VBbGwoJyUyRicsICcvJylcblx0XHRcdC5yZXBsYWNlQWxsKCclM0YnLCAnPycpO1xuXHR9LFxuXG5cdGdlbmVyYXRlU2VsZWN0b3IoKSB7XG5cdFx0bGV0IGEgPSAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWjEyMzQ1Njc4OTAnLnNwbGl0KCcnKSxcblx0XHRcdGIgPSBbXTtcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IDMyOyBpKyspIHtcblx0XHRcdGxldCBqID0gKE1hdGgucmFuZG9tKCkgKiAoYS5sZW5ndGggLSAxKSkudG9GaXhlZCgwKTtcblx0XHRcdGJbaV0gPSBhW2pdO1xuXHRcdH1cblx0XHRsZXQgc2VsZWN0b3IgPSBiLmpvaW4oJycpO1xuXG5cdFx0bGV0IGZpbmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbbmV2aWdlbi1hdWRpdC1maWVsZC1tb2RhbD1cImNvbnRhaW5lclwiXVtkYXRhLXNlbGVjdG9yPVwiJyArIHNlbGVjdG9yICsgJ1wiXScpO1xuXHRcdGlmICghZmluZCkge1xuXHRcdFx0cmV0dXJuIHNlbGVjdG9yO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5nZW5lcmF0ZVNlbGVjdG9yKCk7XG5cdFx0fVxuXHR9LFxufTtcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHtcblx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW25ldmlnZW4tYXVkaXQtZmllbGQtbW9kYWw9XCJjb250YWluZXJcIl0nKS5mb3JFYWNoKChjb250YWluZXIpID0+IHtcblx0XHROZXZpZ2VuQXVkaXRGaWVsZE1vZGFsLmluaXRpYWxpemF0aW9uKGNvbnRhaW5lcik7XG5cdH0pO1xufSk7XG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdzdWJmb3JtLXJvdy1hZGQnLCAoZXZlbnQpID0+IHtcblx0ZXZlbnQudGFyZ2V0LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tuZXZpZ2VuLWF1ZGl0LWZpZWxkLW1vZGFsPVwiY29udGFpbmVyXCJdJykuZm9yRWFjaCgoY29udGFpbmVyKSA9PiB7XG5cdFx0TmV2aWdlbkF1ZGl0RmllbGRNb2RhbC5pbml0aWFsaXphdGlvbihjb250YWluZXIpO1xuXHR9KTtcbn0pXG4iXSwibmFtZXMiOlsid2luZG93IiwiTmV2aWdlbkF1ZGl0RmllbGRNb2RhbCIsImluaXRpYWxpemF0aW9uIiwiY29udGFpbmVyIiwib2xkU2VsZWN0b3IiLCJnZXRBdHRyaWJ1dGUiLCJuZXdTZWxlY3RvciIsImdlbmVyYXRlU2VsZWN0b3IiLCJzZXRBdHRyaWJ1dGUiLCJoYXNBdHRyaWJ1dGUiLCJyZXBsYWNlQWxsIiwiaW5uZXJIVE1MIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJtb2RhbCIsInNldE1vZGFsc1VybFBhcmFtIiwic2V0VmFsdWUiLCJxdWVyeVNlbGVjdG9yIiwidmFsdWUiLCJzZWxlY3RJdGVtIiwiZWxlbWVudCIsImlkIiwic2VsZWN0b3IiLCJKb29tbGEiLCJNb2RhbCIsImdldEN1cnJlbnQiLCJjbG9zZSIsInByb2Nlc3NJdGVtIiwiYnV0dG9uIiwidGFzayIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsInRhc2tfcHJlZml4IiwibW9kYWxfaWQiLCJmb3JtX2lkIiwiZmllbGRfaWQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaWZyYW1lIiwiaWZyYW1lX2lkIiwicmVwbGFjZSIsImlmcmFtZURvY3VtZW50IiwiY29udGVudERvY3VtZW50Iiwic3VibWl0dGVkVGFzayIsImNvbnRlbnRXaW5kb3ciLCJzdWJtaXRidXR0b24iLCJtb2RhbE92ZXJsYXkiLCJzdHlsZSIsImRpc3BsYXkiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJzZXRDdXJyZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwidGFyZ2V0IiwiZmllbGQiLCJwYXJzZUludCIsImhhc1ZhbHVlIiwiZm9ybXZhbGlkYXRvciIsImlzVmFsaWQiLCJjaGFuZ2VFdmVudCIsImZpZWxkX3RpdGxlIiwiZGF0YSIsInVybCIsInRpdGxlIiwiVGV4dCIsIl8iLCJzZXRGaWVsZFZhbHVlIiwicmVxdWVzdCIsIm1ldGhvZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJoZWFkZXJzIiwib25TdWNjZXNzIiwicmVzcG9uc2UiLCJwYXJzZSIsInN1Y2Nlc3MiLCJFcnJvciIsIm1lc3NhZ2UiLCJlcnJvciIsInJlbmRlck1lc3NhZ2VzIiwib25FcnJvciIsImRpc3BsYXlCdXR0b25zIiwibmV3VmFsdWUiLCJtb2RhbF9lZGl0IiwiZGlzcGF0Y2hFdmVudCIsIkV2ZW50IiwiYnV0dG9uX3NlbGVjdCIsImJ1dHRvbl9jcmVhdGUiLCJidXR0b25fZWRpdCIsImJ1dHRvbl9jbGVhciIsImltYWdlIiwic3JjIiwibmFtZSIsInJlcGxhY2VVcmxQYXJhbSIsIm91dGVyIiwiY3JlYXRlRWxlbWVudCIsImluaXRpYWxpc2VNb2RhbCIsInNlYXJjaFBhcmFtcyIsIlVSTFNlYXJjaFBhcmFtcyIsInNldCIsInRvU3RyaW5nIiwiZGVsZXRlIiwiYSIsInNwbGl0IiwiYiIsImkiLCJqIiwiTWF0aCIsInJhbmRvbSIsInRvRml4ZWQiLCJqb2luIiwiZmluZCJdLCJzb3VyY2VSb290IjoiIn0=