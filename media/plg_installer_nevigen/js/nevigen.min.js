(()=>{"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){for(var i=0;t.length>i;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,n(a.key),a)}}function n(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var a=i.call(t,n);if("object"!=e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return t+""}(t,"string");return"symbol"==e(n)?n:n+""}if(!Joomla)throw Error("Joomla API is not properly initialised");var i=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=Joomla.getOptions("plg_installer_nevigen"),this.controller=!(!this.options||!this.options.controller)&&this.options.controller,this.csrf=Joomla.getOptions("csrf.token"),this.activeFilters=[]},(n=[{key:"initialise",value:function(){this.showToast(!1),this.listExtensions(),this.loadActions()}},{key:"listExtensions",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=new FormData;n.set("action","getListExtensions");var i=document.querySelector("#nevigenList");if(i){if(t){var a=i.querySelectorAll('input[name*="filter"]');a.length>0&&a.forEach((function(e){e.value&&n.set(e.getAttribute("name"),e.value)}))}var r=this.getParamByUrl();r&&n.set("filter[search]",r),this.sendAjax(n).then((function(t){t&&(i.innerHTML=!!t.success&&t.data||t.message,!0===t.success&&(r&&e.getParamByUrl("nevigen_search",!0),e.loadActions()))})).catch((function(){}))}}},{key:"loadActions",value:function(){var e=this,t=document.querySelector("#nevigenList"),n=t.querySelectorAll("[data-extension]"),i=t.querySelectorAll("[data-extension-update]");n.length>0&&n.forEach((function(t){t.addEventListener("click",(function(n){n.preventDefault(),document.body.appendChild(document.createElement("joomla-core-loader"));var i=t.getAttribute("data-extension"),a=t.closest("[data-nevigen-filter-free]");if(i){var r=new FormData;r.set("action","installExtension"),r.set("extension",i),a&&"1"===a.getAttribute("data-nevigen-filter-free")&&r.set("free",1),e.sendAjax(r).then((function(t){t&&t.success?window.location.reload():(document.querySelector("joomla-core-loader").remove(),e.showToast(t.message,"error"))})).catch((function(){}))}}))})),i.length>0&&i.forEach((function(t){t.style.display="",t.addEventListener("click",(function(n){n.preventDefault(),document.body.appendChild(document.createElement("joomla-core-loader"));var i=t.getAttribute("data-extension-update");if(i){var a=new FormData;a.set("action","updateExtension"),a.set("extension",i),e.sendAjax(a).then((function(t){t&&t.success?window.location.reload():(document.querySelector("joomla-core-loader").remove(),e.showToast(t.message,"error"))})).catch((function(){}))}}))}))}},{key:"setHideFilter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-1",n="[data-nevigen-filter-"+e+"]";if("free"===e||"install"===e){var i=document.querySelector('input[name="nevigen_type_free"]'),a=document.querySelector('input[name="nevigen_hide_install"]');"free"===e&&i&&(!1===i.checked?(t="-1",delete this.activeFilters[e]):this.activeFilters[e]=!0),"install"===e&&a&&(!1===a.checked?(t="-1",delete this.activeFilters[e]):this.activeFilters[e]=!0),"install"!==e&&this.activeFilters.install&&(n+='[data-nevigen-filter-install="0"]'),"free"!==e&&this.activeFilters.free&&(n+='[data-nevigen-filter-free="1"]');var r=document.querySelectorAll("#nevigenList "+n);r.length>0&&r.forEach((function(n){if("-1"===t)n.style.display="";else{var i=n.getAttribute("data-nevigen-filter-"+e);n.style.display=i===""+t?"":"none"}}))}}},{key:"runSearch",value:function(e){"Enter"===e.key&&(e.preventDefault(),this.listExtensions(!0))}},{key:"resetAllFilters",value:function(){window.location.href="/administrator/index.php?option=com_installer&view=install"}},{key:"getParamByUrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"nevigen_search",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=window.location.href;if(n.includes("&"+e+"=")){if(n=new URL(window.location.href),t)return n.searchParams.delete("nevigen_search"),window.history.replaceState({},"",n),!0;var i=new URLSearchParams(n.search);return i.get(e)}return!1}},{key:"showToast",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"notice",n=document.querySelector("#toast-container");if(!1!==e){n||((n=document.createElement("div")).id="toast-container",n.className="toast-container position-fixed bottom-0 end-0 p-3",n.style.zIndex=11,document.body.appendChild(n));var i=document.createElement("div"),a="error"===t?" text-danger":" text-info";i.className="toast align-items-center border-0 mb-3",i.setAttribute("role","alert"),i.setAttribute("aria-live","assertive"),i.setAttribute("aria-atomic","true");var r=document.createElement("div");r.className="toast-header"+a,i.appendChild(r);var o=document.createElement("strong");o.className="me-auto",o.innerText=Joomla.Text._(t),r.appendChild(o);var l=document.createElement("button");l.type="button",l.className="btn-close",l.setAttribute("data-bs-dismiss","toast"),l.setAttribute("aria-label","Close"),r.appendChild(l);var s=document.createElement("div");s.className="toast-body",s.innerHTML=e,i.appendChild(s),n.appendChild(i);var c=new bootstrap.Toast(i,{delay:7e3});c.show(),i.addEventListener("hidden.bs.toast",(function(){i.remove()}))}else n&&n.remove()}},{key:"sendAjax",value:function(e){var t=this;return new Promise((function(n){e.set(t.csrf,1),Joomla.request({url:t.controller,method:"POST",data:e,onSuccess:function(e){var t;try{t=JSON.parse(e)}catch(e){throw Error("Failed to parse JSON")}n(t)}})}))}}])&&t(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n}();window.NevigenInstallerClass=null,window.NevigenInstaller=function(){return null===window.NevigenInstallerClass&&(window.NevigenInstallerClass=new i),window.NevigenInstallerClass},customElements.whenDefined("joomla-tab").then((function(){var e=document.getElementById("myTab").querySelector("button[aria-controls=nevigen]");(e.hasAttribute("aria-expanded")&&"true"===e.getAttribute("aria-expanded")||e.hasAttribute("aria-selected")&&"true"===e.getAttribute("aria-selected"))&&window.NevigenInstaller().initialise(),e.addEventListener("joomla.tab.shown",(function(){var e=window.NevigenInstaller().getParamByUrl();window.NevigenInstaller().initialise(e)}))})),document.addEventListener("DOMContentLoaded",(function(){if(window.NevigenInstaller().getParamByUrl()){var e=document.getElementById("myTab").querySelector("button[aria-controls=nevigen]");(e.hasAttribute("aria-expanded")&&"true"!==e.getAttribute("aria-expanded")||e.hasAttribute("aria-selected")&&"true"!==e.getAttribute("aria-selected"))&&e.click()}}))})();